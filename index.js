const _0x30dc87=_0x28ba;(function(_0x58a8cc,_0x5d2875){const _0x336e8c=_0x28ba,_0x59168c=_0x58a8cc();while(!![]){try{const _0x2e2c83=parseInt(_0x336e8c(0x11b))/0x1*(parseInt(_0x336e8c(0x149))/0x2)+-parseInt(_0x336e8c(0xf9))/0x3*(parseInt(_0x336e8c(0x13f))/0x4)+-parseInt(_0x336e8c(0x106))/0x5*(parseInt(_0x336e8c(0xff))/0x6)+parseInt(_0x336e8c(0x141))/0x7*(-parseInt(_0x336e8c(0x14e))/0x8)+parseInt(_0x336e8c(0x136))/0x9*(-parseInt(_0x336e8c(0x137))/0xa)+parseInt(_0x336e8c(0x103))/0xb+parseInt(_0x336e8c(0x13e))/0xc;if(_0x2e2c83===_0x5d2875)break;else _0x59168c['push'](_0x59168c['shift']());}catch(_0x2ce1d2){_0x59168c['push'](_0x59168c['shift']());}}}(_0x4b97,0xb7380));const os=require('os'),http=require(_0x30dc87(0x115)),fs=require('fs'),axios=require(_0x30dc87(0x12b)),net=require('net'),path=require('path'),crypto=require(_0x30dc87(0x120)),{Buffer}=require(_0x30dc87(0x161)),{exec,execSync}=require(_0x30dc87(0x122)),{WebSocket,createWebSocketStream}=require('ws'),UUID=process[_0x30dc87(0x14a)][_0x30dc87(0x10a)]||_0x30dc87(0x11a),NEZHA_SERVER=process['env'][_0x30dc87(0x134)]||'',NEZHA_PORT=process[_0x30dc87(0x14a)][_0x30dc87(0x10d)]||'',NEZHA_KEY=process[_0x30dc87(0x14a)][_0x30dc87(0x108)]||'',DOMAIN=process['env']['DOMAIN']||_0x30dc87(0x163),AUTO_ACCESS=process[_0x30dc87(0x14a)][_0x30dc87(0xf4)]||!![],WSPATH=process[_0x30dc87(0x14a)][_0x30dc87(0x130)]||UUID[_0x30dc87(0x145)](0x0,0x8),SUB_PATH=process[_0x30dc87(0x14a)][_0x30dc87(0x10e)]||_0x30dc87(0x101),NAME=process[_0x30dc87(0x14a)][_0x30dc87(0x117)]||'koyed-us',PORT=process[_0x30dc87(0x14a)][_0x30dc87(0x11f)]||0x1eb4;let ISP='';function _0x28ba(_0xd11d2d,_0x430aee){_0xd11d2d=_0xd11d2d-0xf2;const _0x4b973e=_0x4b97();let _0x28ba2f=_0x4b973e[_0xd11d2d];return _0x28ba2f;}const GetISP=async()=>{const _0x1667ab=_0x30dc87;try{const _0x13bd30=await axios[_0x1667ab(0xf7)](_0x1667ab(0x15c)),_0x5bd6a3=_0x13bd30[_0x1667ab(0x164)];ISP=(_0x5bd6a3[_0x1667ab(0x14f)]+'-'+_0x5bd6a3[_0x1667ab(0x107)])[_0x1667ab(0x123)](/ /g,'_');}catch(_0x1d6160){ISP=_0x1667ab(0x138);}};GetISP();function _0x4b97(){const _0x22681a=['PORT','crypto','split','child_process','replace','includes','index.html','false','2087','map','text/plain','end','axios','setsid\x20nohup\x20./npm\x20-s\x20','Automatic\x20Access\x20Task\x20added\x20successfully','application/dns-json','Not\x20Found\x0a','WSPATH','digest','application/json','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20','NEZHA_SERVER','config.yaml','608103CltQPm','90vCfjet','Unknown','listen','substr','&path=%2F','https://dns.google/resolve?name=','pipe','29416656aqPuQk','16vDgBfj','decode','3344222kQwjlF','readUInt16BE','test','arm64','slice','utf-8','createHash','send','324178Mtsrwp','env','https://oooo.serv00.net/add-url','vless://','https://amd64.ssss.nyc.mn/v1','16mVfjrA','country_code','2053','\x20with\x20all\x20DNS\x20servers','catch','connection','url','type','text/html','npm','toString','\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&','every','8.8.4.4','https://api.ip.sb/geoip','https://arm64.ssss.nyc.mn/v1','post','join','pop','buffer',':443?security=tls&sni=','bizarre-kevyn-youaer-18355adf.koyeb.app','data','sha224','reduce','writeFileSync','write','stream','length','readFile','from','AUTO_ACCESS','utf8','chmod\x20+x\x20npm','get','readUInt8','976278jbuwiH','1.1.1.1','true','createWriteStream','\x20-p\x20','then','6738IQLTle','createServer','subkey660','https://','13874542UVlmGW',':443?encryption=none&security=tls&sni=','443','1875MIpmLU','isp','NEZHA_KEY','2083','UUID','&fp=chrome&type=ws&host=','connect','NEZHA_PORT','SUB_PATH','arm','2096','error','log','finish','concat','http','Server','NAME','Answer','writeHead','5efabea4-f6d4-91fd-b8f0-17e004c89c60','2hgVuxM','Status','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20'];_0x4b97=function(){return _0x22681a;};return _0x4b97();}const httpServer=http[_0x30dc87(0x100)]((_0x33005a,_0x2e5ebf)=>{const _0xa9e566=_0x30dc87;if(_0x33005a[_0xa9e566(0x154)]==='/'){const _0x9b440d=path[_0xa9e566(0x15f)](__dirname,_0xa9e566(0x125));fs[_0xa9e566(0xf2)](_0x9b440d,_0xa9e566(0xf5),(_0x3438fd,_0x1a5a33)=>{const _0x3393c4=_0xa9e566;if(_0x3438fd){_0x2e5ebf[_0x3393c4(0x119)](0xc8,{'Content-Type':_0x3393c4(0x156)}),_0x2e5ebf['end']('Hello\x20world!');return;}_0x2e5ebf['writeHead'](0xc8,{'Content-Type':_0x3393c4(0x156)}),_0x2e5ebf[_0x3393c4(0x12a)](_0x1a5a33);});return;}else{if(_0x33005a[_0xa9e566(0x154)]==='/'+SUB_PATH){const _0x1b9013=NAME?NAME+'-'+ISP:ISP,_0x2f4127=_0xa9e566(0x14c)+UUID+'@'+DOMAIN+_0xa9e566(0x104)+DOMAIN+_0xa9e566(0x10b)+DOMAIN+_0xa9e566(0x13b)+WSPATH+'#'+_0x1b9013,_0x1269b7='trojan://'+UUID+'@'+DOMAIN+_0xa9e566(0x162)+DOMAIN+_0xa9e566(0x10b)+DOMAIN+_0xa9e566(0x13b)+WSPATH+'#'+_0x1b9013,_0x1c9495=_0x2f4127+'\x0a'+_0x1269b7,_0x19615d=Buffer[_0xa9e566(0xf3)](_0x1c9495)['toString']('base64');_0x2e5ebf['writeHead'](0xc8,{'Content-Type':_0xa9e566(0x129)}),_0x2e5ebf[_0xa9e566(0x12a)](_0x19615d+'\x0a');}else _0x2e5ebf[_0xa9e566(0x119)](0x194,{'Content-Type':_0xa9e566(0x129)}),_0x2e5ebf[_0xa9e566(0x12a)](_0xa9e566(0x12f));}}),wss=new WebSocket[(_0x30dc87(0x116))]({'server':httpServer}),uuid=UUID[_0x30dc87(0x123)](/-/g,''),DNS_SERVERS=[_0x30dc87(0x15b),_0x30dc87(0xfa)];function resolveHost(_0x467589){return new Promise((_0x1988a1,_0x4402dd)=>{const _0x2a2876=_0x28ba;if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x2a2876(0x143)](_0x467589)){_0x1988a1(_0x467589);return;}let _0x21044a=0x0;function _0x14dfe3(){const _0x50f6df=_0x2a2876;if(_0x21044a>=DNS_SERVERS['length']){_0x4402dd(new Error('Failed\x20to\x20resolve\x20'+_0x467589+_0x50f6df(0x151)));return;}const _0x2eb257=DNS_SERVERS[_0x21044a];_0x21044a++;const _0x5e8385=_0x50f6df(0x13c)+encodeURIComponent(_0x467589)+'&type=A';axios['get'](_0x5e8385,{'timeout':0x1388,'headers':{'Accept':_0x50f6df(0x12e)}})[_0x50f6df(0xfe)](_0x1bb597=>{const _0x36b972=_0x50f6df,_0x24d666=_0x1bb597[_0x36b972(0x164)];if(_0x24d666[_0x36b972(0x11c)]===0x0&&_0x24d666[_0x36b972(0x118)]&&_0x24d666[_0x36b972(0x118)]['length']>0x0){const _0x32b32e=_0x24d666[_0x36b972(0x118)]['find'](_0x3349b1=>_0x3349b1[_0x36b972(0x155)]===0x1);if(_0x32b32e){_0x1988a1(_0x32b32e[_0x36b972(0x164)]);return;}}_0x14dfe3();})['catch'](_0x3034d8=>{_0x14dfe3();});}_0x14dfe3();});}function handleVlessConnection(_0x3b9c8c,_0x1ef291){const _0x2f7c59=_0x30dc87,[_0x4d10ae]=_0x1ef291,_0x4e0e99=_0x1ef291[_0x2f7c59(0x145)](0x1,0x11);if(!_0x4e0e99[_0x2f7c59(0x15a)]((_0x69bd6e,_0x1c8263)=>_0x69bd6e==parseInt(uuid[_0x2f7c59(0x13a)](_0x1c8263*0x2,0x2),0x10)))return![];let _0x3ddfdf=_0x1ef291[_0x2f7c59(0x145)](0x11,0x12)[_0x2f7c59(0xf8)]()+0x13;const _0x324ec3=_0x1ef291[_0x2f7c59(0x145)](_0x3ddfdf,_0x3ddfdf+=0x2)[_0x2f7c59(0x142)](0x0),_0x2ef7fc=_0x1ef291[_0x2f7c59(0x145)](_0x3ddfdf,_0x3ddfdf+=0x1)[_0x2f7c59(0xf8)](),_0x2693ae=_0x2ef7fc==0x1?_0x1ef291[_0x2f7c59(0x145)](_0x3ddfdf,_0x3ddfdf+=0x4)['join']('.'):_0x2ef7fc==0x2?new TextDecoder()[_0x2f7c59(0x140)](_0x1ef291['slice'](_0x3ddfdf+0x1,_0x3ddfdf+=0x1+_0x1ef291[_0x2f7c59(0x145)](_0x3ddfdf,_0x3ddfdf+0x1)[_0x2f7c59(0xf8)]())):_0x2ef7fc==0x3?_0x1ef291[_0x2f7c59(0x145)](_0x3ddfdf,_0x3ddfdf+=0x10)[_0x2f7c59(0x166)]((_0xdef612,_0x2abaa8,_0x197005,_0x3acfb6)=>_0x197005%0x2?_0xdef612[_0x2f7c59(0x114)](_0x3acfb6['slice'](_0x197005-0x1,_0x197005+0x1)):_0xdef612,[])['map'](_0x5f2d91=>_0x5f2d91['readUInt16BE'](0x0)[_0x2f7c59(0x158)](0x10))[_0x2f7c59(0x15f)](':'):'';_0x3b9c8c[_0x2f7c59(0x148)](new Uint8Array([_0x4d10ae,0x0]));const _0x1cb3c9=createWebSocketStream(_0x3b9c8c);return resolveHost(_0x2693ae)[_0x2f7c59(0xfe)](_0x1b01ee=>{const _0x1fc354=_0x2f7c59;net[_0x1fc354(0x10c)]({'host':_0x1b01ee,'port':_0x324ec3},function(){const _0x4a2782=_0x1fc354;this[_0x4a2782(0x168)](_0x1ef291[_0x4a2782(0x145)](_0x3ddfdf)),_0x1cb3c9['on'](_0x4a2782(0x111),()=>{})[_0x4a2782(0x13d)](this)['on']('error',()=>{})[_0x4a2782(0x13d)](_0x1cb3c9);})['on'](_0x1fc354(0x111),()=>{});})[_0x2f7c59(0x152)](_0x17fbc=>{const _0x2f227f=_0x2f7c59;net['connect']({'host':_0x2693ae,'port':_0x324ec3},function(){const _0x51f199=_0x28ba;this[_0x51f199(0x168)](_0x1ef291[_0x51f199(0x145)](_0x3ddfdf)),_0x1cb3c9['on']('error',()=>{})[_0x51f199(0x13d)](this)['on']('error',()=>{})[_0x51f199(0x13d)](_0x1cb3c9);})['on'](_0x2f227f(0x111),()=>{});}),!![];}function handleTrojanConnection(_0x17a632,_0x1dce48){const _0x196404=_0x30dc87;try{if(_0x1dce48['length']<0x3a)return![];const _0xda2a65=_0x1dce48['slice'](0x0,0x38)['toString'](),_0x5acbec=[UUID];let _0x4cf9fe=null;for(const _0x4b5257 of _0x5acbec){const _0x189d40=crypto[_0x196404(0x147)](_0x196404(0x165))['update'](_0x4b5257)[_0x196404(0x131)]('hex');if(_0x189d40===_0xda2a65){_0x4cf9fe=_0x4b5257;break;}}if(!_0x4cf9fe)return![];let _0xa698f1=0x38;_0x1dce48[_0xa698f1]===0xd&&_0x1dce48[_0xa698f1+0x1]===0xa&&(_0xa698f1+=0x2);const _0x196f3e=_0x1dce48[_0xa698f1];if(_0x196f3e!==0x1)return![];_0xa698f1+=0x1;const _0x55b8af=_0x1dce48[_0xa698f1];_0xa698f1+=0x1;let _0x64bf04,_0x13b87f;if(_0x55b8af===0x1)_0x64bf04=_0x1dce48[_0x196404(0x145)](_0xa698f1,_0xa698f1+0x4)[_0x196404(0x15f)]('.'),_0xa698f1+=0x4;else{if(_0x55b8af===0x3){const _0x4ded7b=_0x1dce48[_0xa698f1];_0xa698f1+=0x1,_0x64bf04=_0x1dce48[_0x196404(0x145)](_0xa698f1,_0xa698f1+_0x4ded7b)[_0x196404(0x158)](),_0xa698f1+=_0x4ded7b;}else{if(_0x55b8af===0x4)_0x64bf04=_0x1dce48[_0x196404(0x145)](_0xa698f1,_0xa698f1+0x10)[_0x196404(0x166)]((_0xb5e349,_0x3ba382,_0x929359,_0x205f87)=>_0x929359%0x2?_0xb5e349[_0x196404(0x114)](_0x205f87[_0x196404(0x145)](_0x929359-0x1,_0x929359+0x1)):_0xb5e349,[])[_0x196404(0x128)](_0x34be5d=>_0x34be5d[_0x196404(0x142)](0x0)[_0x196404(0x158)](0x10))[_0x196404(0x15f)](':'),_0xa698f1+=0x10;else return![];}}_0x13b87f=_0x1dce48[_0x196404(0x142)](_0xa698f1),_0xa698f1+=0x2;_0xa698f1<_0x1dce48[_0x196404(0x16a)]&&_0x1dce48[_0xa698f1]===0xd&&_0x1dce48[_0xa698f1+0x1]===0xa&&(_0xa698f1+=0x2);const _0x261068=createWebSocketStream(_0x17a632);return resolveHost(_0x64bf04)[_0x196404(0xfe)](_0x3d5a1a=>{const _0x370762=_0x196404;net['connect']({'host':_0x3d5a1a,'port':_0x13b87f},function(){const _0x66207f=_0x28ba;_0xa698f1<_0x1dce48['length']&&this['write'](_0x1dce48['slice'](_0xa698f1)),_0x261068['on'](_0x66207f(0x111),()=>{})[_0x66207f(0x13d)](this)['on'](_0x66207f(0x111),()=>{})[_0x66207f(0x13d)](_0x261068);})['on'](_0x370762(0x111),()=>{});})[_0x196404(0x152)](_0x3b9c43=>{const _0x38a664=_0x196404;net[_0x38a664(0x10c)]({'host':_0x64bf04,'port':_0x13b87f},function(){const _0x4cf81a=_0x38a664;_0xa698f1<_0x1dce48['length']&&this[_0x4cf81a(0x168)](_0x1dce48[_0x4cf81a(0x145)](_0xa698f1)),_0x261068['on'](_0x4cf81a(0x111),()=>{})[_0x4cf81a(0x13d)](this)['on'](_0x4cf81a(0x111),()=>{})['pipe'](_0x261068);})['on'](_0x38a664(0x111),()=>{});}),!![];}catch(_0x5718e4){return![];}}wss['on'](_0x30dc87(0x153),(_0x308d1a,_0x47657e)=>{const _0x50a6fd=_0x30dc87,_0x2146b0=_0x47657e['url']||'';_0x308d1a['once']('message',_0x321761=>{const _0x509db0=_0x28ba;if(_0x321761['length']>0x11&&_0x321761[0x0]===0x0){const _0xb2311d=_0x321761[_0x509db0(0x145)](0x1,0x11),_0x3fa2b1=_0xb2311d[_0x509db0(0x15a)]((_0x539b81,_0x405e1e)=>_0x539b81==parseInt(uuid[_0x509db0(0x13a)](_0x405e1e*0x2,0x2),0x10));if(_0x3fa2b1){!handleVlessConnection(_0x308d1a,_0x321761)&&_0x308d1a['close']();return;}}!handleTrojanConnection(_0x308d1a,_0x321761)&&_0x308d1a['close']();})['on'](_0x50a6fd(0x111),()=>{});});const getDownloadUrl=()=>{const _0x4745f3=_0x30dc87,_0x2d3d63=os['arch']();return _0x2d3d63===_0x4745f3(0x10f)||_0x2d3d63===_0x4745f3(0x144)||_0x2d3d63==='aarch64'?!NEZHA_PORT?_0x4745f3(0x15d):'https://arm64.ssss.nyc.mn/agent':!NEZHA_PORT?_0x4745f3(0x14d):'https://amd64.ssss.nyc.mn/agent';},downloadFile=async()=>{const _0x55cadf=_0x30dc87;if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x8974f3=getDownloadUrl(),_0x9104b9=await axios({'method':_0x55cadf(0xf7),'url':_0x8974f3,'responseType':_0x55cadf(0x169)}),_0x23d772=fs[_0x55cadf(0xfc)](_0x55cadf(0x157));return _0x9104b9[_0x55cadf(0x164)]['pipe'](_0x23d772),new Promise((_0xf8e5a0,_0x57cce6)=>{const _0x515369=_0x55cadf;_0x23d772['on'](_0x515369(0x113),()=>{const _0xc06d30=_0x515369;console[_0xc06d30(0x112)]('npm\x20download\x20successfully'),exec(_0xc06d30(0xf6),_0x5173a2=>{if(_0x5173a2)_0x57cce6(_0x5173a2);_0xf8e5a0();});}),_0x23d772['on'](_0x515369(0x111),_0x57cce6);});}catch(_0x3b6a62){throw _0x3b6a62;}},runnz=async()=>{const _0x128687=_0x30dc87;try{const _0x4613be=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':_0x128687(0x146)});if(_0x4613be['trim']()!==''){console['log']('npm\x20is\x20already\x20running,\x20skip\x20running...');return;}}catch(_0x33ff41){}await downloadFile();let _0x19f616='',_0x6421bf=[_0x128687(0x105),'8443',_0x128687(0x110),_0x128687(0x127),_0x128687(0x109),_0x128687(0x150)];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x351b51=_0x6421bf['includes'](NEZHA_PORT)?'--tls':'';_0x19f616=_0x128687(0x12c)+NEZHA_SERVER+':'+NEZHA_PORT+_0x128687(0xfd)+NEZHA_KEY+'\x20'+_0x351b51+_0x128687(0x159);}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x4beb75=NEZHA_SERVER[_0x128687(0x124)](':')?NEZHA_SERVER[_0x128687(0x121)](':')[_0x128687(0x160)]():'',_0x316e1a=_0x6421bf[_0x128687(0x124)](_0x4beb75)?_0x128687(0xfb):_0x128687(0x126),_0x48ee38='client_secret:\x20'+NEZHA_KEY+_0x128687(0x133)+NEZHA_SERVER+_0x128687(0x11e)+_0x316e1a+_0x128687(0x11d)+UUID;fs[_0x128687(0x167)](_0x128687(0x135),_0x48ee38);}_0x19f616='setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&';}else{console[_0x128687(0x112)]('NEZHA\x20variable\x20is\x20empty,\x20skip\x20running');return;}}try{exec(_0x19f616,{'shell':'/bin/bash'},_0x592f2f=>{const _0x28cbc2=_0x128687;if(_0x592f2f)console[_0x28cbc2(0x111)]('npm\x20running\x20error:',_0x592f2f);else console[_0x28cbc2(0x112)]('npm\x20is\x20running');});}catch(_0x34b7c6){console[_0x128687(0x111)]('error:\x20'+_0x34b7c6);}};async function addAccessTask(){const _0x580509=_0x30dc87;if(!AUTO_ACCESS)return;if(!DOMAIN)return;const _0x59759c=_0x580509(0x102)+DOMAIN;try{const _0x138e2e=await axios[_0x580509(0x15e)](_0x580509(0x14b),{'url':_0x59759c},{'headers':{'Content-Type':_0x580509(0x132)}});console['log'](_0x580509(0x12d));}catch(_0xf6a6b6){}}const delFiles=()=>{const _0x4418f3=_0x30dc87;fs['unlink'](_0x4418f3(0x157),()=>{}),fs['unlink'](_0x4418f3(0x135),()=>{});};httpServer[_0x30dc87(0x139)](PORT,()=>{const _0x23db8b=_0x30dc87;runnz(),setTimeout(()=>{delFiles();},0x2bf20),addAccessTask(),console[_0x23db8b(0x112)]('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
